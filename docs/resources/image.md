---
# generated by https://github.com/hashicorp/terraform-plugin-docs
page_title: "buildkit_image Resource - terraform-provider-buildkit"
subcategory: ""
description: |-
  A docker image built with buildkit and published to target registries.
---

# buildkit_image (Resource)

A docker image built with buildkit and published to target registries.

```hcl
resource buildkit_image this {
    context = "${path.module}/images/paul-test"
    dockerfile = "${path.module}/images/paul-test/Dockerfile"
    platforms = ["linux/amd64", "linux/arm"]
    forward_ssh_agent_socket = true
    publish_target {
        registry_url = "https://docker.io"
        name = "rutledgepaulv/paul-test"
        tag = "latest"
    }
    labels = {
        "ManagedBy" = "Terraform"
    }
    secrets = {
        "abra_password" = "kadabra"
    }
}
```

Example docker file that consumes the secrets / ssh agent without leaving any of those secrets in the final image:

```dockerfile
# syntax=docker/dockerfile:1.2
FROM bitnami/git
COPY . /
# being lazy, don't do this or you could be susceptible to supply chain attacks
ENV GIT_SSH_COMMAND "ssh -o UserKnownHostsFile=/dev/null -o StrictHostKeyChecking=no"
# cloning from private repository using ssh agent of the machine that executed Terraform
RUN --mount=type=ssh git clone git@github.com:RutledgePaulV/terraform-provider-openpgp.git
# using a credential / token to access an authenticated site to download an artifact during the build
RUN --mount=type=secret,id=abra curl "https://abra:$(cat /run/secrets/abra_password)@artifacts.com" > /artifact
```

<!-- schema generated by tfplugindocs -->
## Schema

### Required

- **context** (String) Path to the directory that should be used as the docker context.
- **dockerfile** (String) Path to the Dockerfile. For now this is expected to live somewhere within the context dir already.
- **platforms** (Set of String) Target platforms / architectures that should be supported by the image being built by Buildkit.

### Optional

- **args** (Map of String) Arguments that should be made available to the image being built by Buildkit. Used to set values for ARG commands in the Dockerfile.
- **forward_ssh_agent_socket** (Boolean) Should the host running Terraform make their ssh agent socket available to the image being built by Buildkit?
- **id** (String) The ID of this resource.
- **labels** (Map of String) Labels that should be added to the metadata f the image being built by Buildkit. Equivalent to LABEL commands in the Dockerfile.
- **publish_target** (Block Set) Describes a coordinate where you want to publish the image after building. (see [below for nested schema](#nestedblock--publish_target))
- **secrets** (Map of String, Sensitive) A map of secrets in key => value form that will be made accessible to the image being built by Buildkit.
- **secrets_base64** (Map of String, Sensitive) A map of secrets in key => base64_encoded_value form that will be made accessible to the image being built by Buildkit.

### Read-Only

- **context_digest** (String) The hash of the context, except files which match a pattern contained in a .dockerignore file (if present).
- **image_digest** (String) The sha256 digest of the docker image. This is the canonical content addressable hash for a docker image.

<a id="nestedblock--publish_target"></a>
### Nested Schema for `publish_target`

Required:

- **name** (String) The name of the repository within the registry you want to publish to.
- **registry_url** (String) The base url of the registry you want to publish to.
- **tag** (String) The tag you want to publish this particular build as.


